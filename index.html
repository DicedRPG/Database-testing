<!-- emergency-fix.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DICED: Cooking RPG Companion</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="new-styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#A2BC58">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <!-- Main Container (Home Page) -->
    <div id="main-container" class="page-container">
        <!-- Your existing content here -->
    </div>
    
    <!-- Quest Detail Container (Quest Detail Page) -->
    <div id="quest-detail-container" class="page-container hidden">
        <!-- Quest detail content will be dynamically loaded here -->
        <div class="loading-spinner">Loading quest details...</div>
    </div>
    
    <!-- Settings Container (Settings Page) -->
    <div id="settings-container" class="page-container hidden">
        <!-- Settings content will be dynamically loaded here -->
        <div class="loading-spinner">Loading settings...</div>
    </div>
    
    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- JavaScript includes - Original Order -->
    <script src="data.js"></script>
    <script src="database-service.js"></script>
    <script src="user-state-service.js"></script>
    <script src="router.js"></script>
    <script src="app-controller.js"></script>
    
    <!-- Emergency initialization script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Emergency initialization script running...');
        
        // Initialize using the original approach
        if (window.questDatabase) {
            window.questDatabase.initialize().then(() => {
                console.log('Database initialized');
                
                if (window.userStateService) {
                    window.userStateService.initialize().then(() => {
                        console.log('User state initialized');
                        
                        if (window.appController) {
                            window.appController.initialize().then(() => {
                                console.log('App controller initialized');
                            }).catch(error => {
                                console.error('Failed to initialize app controller:', error);
                            });
                        }
                    }).catch(error => {
                        console.error('Failed to initialize user state:', error);
                    });
                }
            }).catch(error => {
                console.error('Failed to initialize database:', error);
            });
        }
        
        // Add a backup initialization that runs after a delay
        // This is in case the above initialization fails for some reason
        setTimeout(function() {
            // Check if app is properly initialized by looking for UI elements
            if (!document.querySelector('.quest-item')) {
                console.log('No quest items found, running backup initialization...');
                
                // Clear localStorage except for progress data
                const progressData = localStorage.getItem('diced_rpg_state');
                
                // Keep only progress data
                if (progressData) {
                    const tempData = progressData;
                    // Refresh quests from QUEST_DATA global
                    if (window.QUEST_DATA && window.QUEST_DATA.length > 0) {
                        localStorage.setItem('diced_rpg_quests', JSON.stringify(window.QUEST_DATA));
                    }
                    localStorage.setItem('diced_rpg_state', tempData);
                    
                    // Reload the page to get a fresh start
                    window.location.reload();
                }
            }
        }, 5000); // Wait 5 seconds before checking and potentially reloading
    });
    </script>
</body>
</html>
